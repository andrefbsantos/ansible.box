---

- shell: echo {{ item }} hold | dpkg --set-selections
  with_items:
    - udev
    - initscripts
    - upstart

- command: dpkg-divert --local --rename --add {{ item }}
  with_items: box_container_replace

- file:
    src: "/bin/true"
    dest: "{{ itemÂ }}"
    owner: root
    group: root
    force: yes
    state: link
  with_items: box_container_replace


- file:
    path: "{{ item }}"
    owner: root
    group: root
    state: directory
  with_items:
    - "/etc/my_init.d"
    - "/etc/container_environment"

- copy:
    src: my_init
    dest: /sbin/my_init
    owner: root
    group: root
    mode: 0755

- copy:
    src: "init/{{ item }}"
    dest: "/etc/my_init.d/{{ item }}"
    owner: root
    group: root
    mode: 0755
  with_items:
    - "50_passenger_env.sh"

- name: create locales env
  lineinfile:
    create: yes
    state: present
    dest: "/etc/container_environment/{{ item }}"
    line: "{{ box_locale }}"
  with_items:
    - LANG
    - LC_ALL
    - LANGUAGE
